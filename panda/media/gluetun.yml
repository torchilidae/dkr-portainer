services:
  gluetun:
    image: qmcgaw/gluetun:v3.39.0
    container_name: gluetun
    restart: always
    networks:
      - traefik_internal
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    volumes:
      - gluetun:/gluetun
    labels:
      - "traefik.enable=true"
      # Prowlarr related labels
      - "traefik.http.routers.vpn-prowlarr.service=vpn-prowlarr"
      - "traefik.http.routers.vpn-prowlarr.entrypoints=websecure"
      - "traefik.http.routers.vpn-prowlarr.tls.certresolver=myresolver"
      - "traefik.http.routers.vpn-prowlarr.rule=Host(`prowlarr.panda.tsphotoclicks.net`)"
      - "traefik.http.services.vpn-prowlarr.loadbalancer.server.port=9696"
      - "traefik.http.routers.vpn-prowlarr.middlewares=authentik@docker"
      # Qbittorrent related labels
      - "traefik.http.routers.vpn-qbittorrent.service=vpn-qbittorrent"
      - "traefik.http.routers.vpn-qbittorrent.entrypoints=websecure"
      - "traefik.http.routers.vpn-qbittorrent.tls.certresolver=myresolver"
      - "traefik.http.routers.vpn-qbittorrent.rule=Host(`qbittorrent.panda.tsphotoclicks.net`)"
      - "traefik.http.services.vpn-qbittorrent.loadbalancer.server.port=8085"
      - "traefik.http.routers.vpn-qbittorrent.middlewares=authentik@docker"
      # Radarr related labels
      - "traefik.http.routers.vpn-radarr.service=vpn-radarr"
      - "traefik.http.routers.vpn-radarr.entrypoints=websecure"
      - "traefik.http.routers.vpn-radarr.tls.certresolver=myresolver"
      - "traefik.http.routers.vpn-radarr.rule=Host(`radarr.panda.tsphotoclicks.net`)"
      - "traefik.http.services.vpn-radarr.loadbalancer.server.port=7878"
      - "traefik.http.routers.vpn-radarr.middlewares=authentik@docker"
      # Sonarr related labels
      - "traefik.http.routers.vpn-sonarr.service=vpn-sonarr"
      - "traefik.http.routers.vpn-sonarr.entrypoints=websecure"
      - "traefik.http.routers.vpn-sonarr.tls.certresolver=myresolver"
      - "traefik.http.routers.vpn-sonarr.rule=Host(`sonarr.panda.tsphotoclicks.net`)"
      - "traefik.http.services.vpn-sonarr.loadbalancer.server.port=8989"
      - "traefik.http.routers.vpn-sonarr.middlewares=authentik@docker"
    environment:
      - "VPN_SERVICE_PROVIDER=${VPN_SERVICE_PROVIDER}"
      - "VPN_TYPE=${VPN_TYPE}"
      - "UPDATER_PERIOD=${UPDATER_PERIOD}"
      - "OPENVPN_USER=${OPENVPN_USER}"
      - "OPENVPN_PASSWORD=${OPENVPN_PASSWORD}"
      - "SERVER_COUNTRIES=${SERVER_COUNTRIES}"
      - "TZ=America/Phoenix"
    healthcheck:
      test: ping -c 1 www.google.com || exit 1
      interval: 60s
      timeout: 20s
      retries: 5

volumes:
  gluetun:
    external: true

networks:
  traefik_internal:
    external: true